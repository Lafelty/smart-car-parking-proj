<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Parking System</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <div class="container">
    <h1>üöó Smart Parking System</h1>
    <p class="subtitle">Real-time Parking Space Detection & Monitoring</p>

    <div class="stats-bar">
      <div class="stat-card">
        <div class="stat-number" id="availableSpaces">--</div>
        <div class="stat-label">Available</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="occupiedSpaces">--</div>
        <div class="stat-label">Occupied</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="totalSpaces">--</div>
        <div class="stat-label">Total Spaces</div>
      </div>
    </div>

    <div class="image-container">
      <div class="status-badge" id="statusBadge">‚óè LIVE</div>
      <img src="{{ url_for('video') }}" alt="Live Parking Feed">
    </div>

    <p id="statusText" style="margin-top: 20px; color: #4a5568; font-size: 1.1rem; font-weight: 500;"></p>

    <button class="refresh-btn" onclick="location.reload()">‚Üª Refresh Feed</button>
  </div>

  <footer>
    <p>¬© 2025 Smart Parking System | Live Monitoring Active</p>
  </footer>

  <script>
    async function getStatus() {
      try {
        const res = await fetch('/status');
        const data = await res.json();
        
        // Update status text
        document.getElementById("statusText").innerText = data.message || '';
        
        // If your API returns parking data, update the stats
        if (data.available !== undefined) {
          document.getElementById("availableSpaces").innerText = data.available;
        }
        if (data.occupied !== undefined) {
          document.getElementById("occupiedSpaces").innerText = data.occupied;
        }
        if (data.total !== undefined) {
          document.getElementById("totalSpaces").innerText = data.total;
        }
        
        // Update badge color based on availability
        const badge = document.getElementById("statusBadge");
        if (data.available !== undefined) {
          if (data.available === 0) {
            badge.style.background = 'rgba(239, 68, 68, 0.95)';
            badge.innerText = '‚óè FULL';
          } else if (data.available < 5) {
            badge.style.background = 'rgba(251, 191, 36, 0.95)';
            badge.innerText = '‚óè LOW';
          } else {
            badge.style.background = 'rgba(16, 185, 129, 0.95)';
            badge.innerText = '‚óè LIVE';
          }
        }
      } catch (error) {
        console.error('Error fetching status:', error);
        document.getElementById("statusText").innerText = 'Error loading status';
      }
    }

    // Initial load
    getStatus();
    
    // Refresh status every 5 seconds
    setInterval(getStatus, 5000);
  </script>
</body>
</html>
